# 概要
小・中規模サイト開発用のgulp環境です。  
レスポンシブデザインの想定で設定しています。

# 開発環境について
## 各ディレクトリの役割
### src/
開発用ディレクトリです。開発作業時はこのディレクトリ内に`.ejs`, `.scss`, 圧縮前の`.js`を作成して開発を進めます。
### dev/
開発時確認用ディレクトリです。開発作業時は、このディレクトリ以下をブラウザで表示してください。  
あくまで開発時の表示確認用なので、jsファイルは結合のみ、画像ファイルはコピーするのみにとどめています。  
実際の表示速度の確認ができないので、このディレクトリ内のファイルは<span style="color: #f00;">__テストアップには使用しないでください。__</span>

### dist/
テストアップ用ディレクトリです。テストアップ用に、jsを難読化して圧縮, 画像ファイルはサイズを圧縮しています。  
テストアップ時は、<span style="color: #f00;">__このディレクトリ以下のファイルをテストアップしてください。__</span>

### release/
納品用ディレクトリです。納品時はこのディレクトリ以下のファイルを使用してください。  
`dist/` 同様、jsや画像の圧縮をしているほか、htmlファイルにリマーケタグ等を自動挿入できるようになっています。  
<span style="color: #f00;">__このディレクトリ以下のファイルで納品データを作成してください。__</span>

### json/
この中にある`.json`ファイルに、ejsに吐き出すための共通データが記述してあります。  
`.json`ファイルのデータの取扱については[別途説明](#ejs-json-)します。

### gulp/
分割したgulpの設定ファイルが格納してあります。

### tags/
自動挿入用のリマーケタグを記述したhtmlファイルが格納されています。


## gulpのタスク・設定ファイルについて
### タスク
#### gulp watch
開発時に実行するウォッチコマンドです。  
`src/` 以下を監視し、ファイルに何かしらの変更があれば各ファイルごとに指定された処理を実行して、`dev/` 以下にファイルを吐き出します。  
なお、画像ファイルを監視対象に含めると処理が重くなるので、画像ファイルは別途タスクで処理します。

#### gulp dev:image
`src/` 以下の画像ファイルを`dev/`以下にコピーします。  

#### gulp dev:default
`src/` 以下のすべてのファイルに対して、各種処理を実行した上で、`dev/`以下に吐き出します。

#### gulp dev:clean
`dev/` 以下のすべてのファイルを削除します。  
このコマンド実行後に、`gulp dev:default`を実行すると、`src/`以下で削除したファイルが`dev/`以下でも取り除かれた状態になります。

#### gulp dist:default
`src/` 以下のすべてのファイルに対して、テストアップ用の各種処理を実行した上で、`dist/`以下に吐き出します。  
画像サイズの圧縮、jsファイルの難読化等を行なっており、`dev/` 以下のファイルより表示速度が速いため、必ずこちらをテストアップしてください。

#### gulp dist:clean
`dist/` 以下のすべてのファイルを削除します。  
このコマンド実行後に、`gulp dist:default`を実行すると、`src/`以下で削除したファイルが`dist/`以下でも取り除かれた状態になります。

#### gulp release
`src/` 以下のすべてのファイルに対して、納品用の各種処理を実行した上で、`release/`以下に吐き出します。  
画像サイズの圧縮、jsファイルの難読化の他、`.html`、`.php`ファイルに対してリマーケタグ等納品時にのみ追加が必要なタグや文字列の追加処理を自動で行うので、  
納品データは必ずこちらのディレクトリ以下から作成してください。

#### gulp release:clean
`release/` 以下のすべてのファイルを削除します。  
このコマンド実行後に、`gulp release`を実行すると、`src/`以下で削除したファイルが`release/`以下でも取り除かれた状態になります。


### gulpの設定ファイルについて
gulpの設定ファイルは下記のように分割して存在します。  

    gulp/
        config.js           処理対象の各種ファイル・ディレクトリを指定するパス群
        task/               実際のタスクを記述したファイルが入っているディレクトリ
            dev.js          dev/ 以下に吐き出すファイルに対する処理を記述
            dist.js         dist/ 以下に吐き出すファイルに対する処理を記述
            release.js      release/ 以下に吐き出すファイルに対する処理を記述

#### config.jsについて
config.js内には、`common_js_sort_pc`と`common_js_sort_sp`という変数に、jsのファイルパスを指定する記述があります。  
これは、`assets/js/common.js`に結合するファイルと、結合する順番を指定するための変数です。  
`src/assets/js/common/` 以下にファイルを追加した場合、`common_js_sort_pc`に、追加したファイルのパスを  
結合したい順番になるよう追加してください。  
  
※`common_js_sort_sp`はSP版用の設定です。`src/sp/assets/js/common/`以下にファイルを追加した場合に  
　記述を追加します。


## ejs出力用　jsonファイルについて
### common.json
サイト内共通の設定項目を記述しています。

    {
        "lang"        : "ja",
        "site_name"   : "サイト名",
        "author"      : "サイトの管理者",
        "page_title"  : "ページタイトルデフォルト | サイト名",
        "keywords"    : "キーワード,keyword",
        "description" : "サイトの説明デフォルト",
        "site_url"    : "https://testsample.hoge/",
        "og"          : {
            "image" : "https://testsample.hoge/ogp.png"
        },
        "twitter" : {
            "site" : "@",
            "card" : "summary_large_image"
        }
    }

#### lang
`<html lang="">`に指定する言語コード

#### site_name
サイト名

### author
サイトの管理者名

#### keywords
metaキーワード

#### site_url
サイトURL

#### og
metaのogpタグに指定する項目

#### twitter
metaのTwitterカードタグに設定する項目

### pages.json
各ページごとの個別設定が記述してあります。  
例：インデックスページ  
  
`"index"`部分は、ページの識別IDで、インデックス以外の下層はディレクトリ名を指定します。  
ディレクトリ名に含まれる`_`や`-`は省略してください。`hoge/`の場合は`"hoge"`、  
`hoge/fuga/`のような二階層・三階層下の場合は、`"hoge-fuga"`というように、ディレクトリの区切りを`-`で表現します。

    {
        "index" : {
            "path"        : "./",
            "pagetype"    : "Index",
            "url"         : "",
            "title"       : "サイト名",
            "description" : false,
            "og" : {
                "type" : "website",
                "image" : false
            }
        }
    }

#### path
サイトのルートまでのパス。ルートから一階層下なら`../`、二階層下なら`../../`となります。

#### pagetype
js処理用のパラメータ。識別IDの頭文字と`-`直後の一文字を大文字にしてください。  
`index`→`Index`、`hoge-fuga`→`HogeFuga`

#### url
ページのURL。metaタグ用です。  
`url`は`http://testsample.hoge/`以下の部分のみ指定します。  
実際のURLが`http://testsample.hoge/hoge/`なら`hoge/`となります。

#### title
ページタイトル。  
下層の場合、`◯◯◯ | サイト名`の`◯◯◯ | `部分を入れます。

#### description
metaのdescriptionを指定します。

#### og
metaのogpタグに指定するページ個別の項目です。  

#### twitter
metaのTwitterカードタグに設定する項目です。

